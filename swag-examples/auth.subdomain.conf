server {
    listen 443 ssl;
    listen [::]:443 ssl;

    server_name auth.*;

    include /config/nginx/ssl.conf;

    location / {
        # Allow the app frontend to call auth APIs with cookies from the browser.
        if ($request_method = OPTIONS) {
            add_header Access-Control-Allow-Origin "https://app.dgglocal.com" always;
            add_header Access-Control-Allow-Credentials "true" always;
            add_header Access-Control-Allow-Headers "Content-Type,Authorization,X-Requested-With" always;
            add_header Access-Control-Allow-Methods "GET,POST,OPTIONS" always;
            return 204;
        }

        add_header Access-Control-Allow-Origin "https://app.dgglocal.com" always;
        add_header Access-Control-Allow-Credentials "true" always;

        proxy_pass http://destiny-auth:8000;
        include /config/nginx/proxy.conf;
    }
}
