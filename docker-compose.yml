services:
  swag:
    image: lscr.io/linuxserver/swag:latest
    container_name: swag
    cap_add:
      - NET_ADMIN
    environment:
      PUID: "1000"
      PGID: "1000"
      TZ: "America/Chicago"
      URL: "dgglocal.com"
      SUBDOMAINS: "wildcard"
      VALIDATION: "http"
      ONLY_SUBDOMAINS: "true"
      STAGING: "true"
    volumes:
      - ./swag-config:/config
    ports:
      - "443:443"
      - "80:80"
    restart: unless-stopped
    networks:
      - proxy

  destiny-auth:
    build: .
    container_name: destiny-auth
    environment:
      DGG_CLIENT_ID: "YOUR_DGG_CLIENT_ID"
      DGG_CLIENT_SECRET: "YOUR_DGG_CLIENT_SECRET"
      REDIRECT_URI: "https://auth.dgglocal.com/callback"
      POST_LOGIN_REDIRECT: "http://localhost:5173/"
      SESSION_SIGNING_KEY: "CHANGE_ME_TO_A_LONG_RANDOM_STRING"
      COOKIE_SECURE: "false"
      COOKIE_SAMESITE: "Lax"
      COOKIE_DOMAIN: ".dgglocal.com"
      SESSION_TTL_SECONDS: "86400"
      ADMIN_USER_IDS: "12345,67890"
      LINK_SERVER_KEY: "CHANGE_ME_SERVER_KEY"
      LINK_DB_HOST: "mariadb"
      LINK_DB_PORT: "3306"
      LINK_DB_USER: "dggauth"
      LINK_DB_PASSWORD: "change_me_password"
      LINK_DB_PASSWORD_FILE: "/run/secrets/plugin_db_password"
      LINK_DB_NAME: "dggauth"
    restart: unless-stopped
    networks:
      - proxy

  test-app:
    image: ealen/echo-server:latest
    container_name: testapp
    restart: unless-stopped
    networks:
      - proxy

networks:
  proxy:
    name: proxy
